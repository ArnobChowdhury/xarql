$(document).ready(function(){var e=document.getElementById("domain").getAttribute("value");function i(j){var m=decodeURIComponent(window.location.search.substring(1)),l=m.split("&"),n,k;for(k=0;k<l.length;k++){n=l[k].split("=");if(n[0]===j){return n[1]===undefined?true:n[1]}}}function d(){$(".status").each(function(){$(this).text("trying")});var j=$("<div></div>").load(e+"/polr/updt?id="+$("#main-post-id").text()+"&page="+$("#page").text()+"&sort="+$("#sort").text()+"&flow="+$("#flow").text()+"#full",function(l,k,m){if(k=="error"){$(".status").each(function(){$(this).text(m.statusText)})}else{$("#main-post").replaceWith(j.find("#main-post-container").html());$("#replies").replaceWith(j.find("#replies-container").html());$("title").text(j.find("#main-post-title").text()+" ~ xarql");c();$(".status").each(function(){$(this).text(m.statusText)})}})}var f=i("refresh");if(typeof f!="undefined"&&f==="true"){d();history.pushState("xarql","xarql",window.location.pathname)}$(".update-button").each(function(){var j=$(this);j.on("click",function(){d()})});$("#post-form").submit(function(m){m.preventDefault();$(".status").each(function(){$(this).text("trying")});var j=$(this),o=j.find("input[name='title']").val(),l=j.find("textarea[name='content']").val(),n=j.find("input[name='answers']").val(),k=j.attr("action");j.trigger("reset");$("#replying-to-input").val(parseInt($("#main-post-id").text()));$.ajax({type:"POST",url:k,data:{title:o,content:l,answers:n,}}).done(function(){$(".status").each(function(){$(this).text("success")})}).fail(function(){$(".status").each(function(){j.find("input[name='title']").val(o);j.find("textarea[name='content']").val(l);j.find("input[name='answers']").val(n);$(this).text("error")})}).always(function(){window.setTimeout(d,500)})});function nav(){$(".status").each(function(){$(this).text("trying")});var k=$("#nav-form"),m=$("#page-dropdown").val(),l=$("#sort-dropdown").val(),j=$("#flow-dropdown").val();var n=$("<div></div>").load(e+"/polr/updt?id="+$("#main-post-id").text()+"&page="+m+"&sort="+l+"&flow="+j,function(p,o,q){if(o=="error"){$(".status").each(function(){$(this).text(q.statusText)})}else{$("#main-post").replaceWith(n.find("#main-post-container").html());$("#replies").replaceWith(n.find("#replies-container").html());$("title").text(n.find("#main-post-title").text()+" ~ xarql");history.pushState("xarql","xarql",window.location.pathname+"?page="+m+"&sort="+l+"&flow="+j);$("#page").text(m);$("#sort").text(l);$("#flow").text(j);c();if(m>0){$("#prev-form").show();$("#prev-form").css("display","inline")}else{$("#prev-form").hide()}if(m<9){$("#next-form").show();$("#next-form").css("display","inline")}else{$("#next-form").hide()}$(".status").each(function(){$(this).text(q.statusText)});$("html, body").animate({scrollTop:0},"fast")}})}$("#nav-form").submit(function(j){j.preventDefault();nav()});$("#next-form").submit(function(j){j.preventDefault();var k=parseInt($("#page-dropdown").val());if(k<9){$("#page-dropdown").val(k+1)}nav()});$("#prev-form").submit(function(j){j.preventDefault();var k=parseInt($("#page-dropdown").val());if(k>0){$("#page-dropdown").val(k-1)}nav()});$("html").css("font-size",Cookies.get("font-size"));$("#text-up").on("click",function(){var j=parseFloat(window.getComputedStyle(document.getElementById("html")).fontSize);$("html").css("font-size",(j+1)+"px");Cookies.set("font-size",(j+1)+"px")});$("#text-dn").on("click",function(){var j=parseFloat(window.getComputedStyle(document.getElementById("html")).fontSize);$("html").css("font-size",(j-1)+"px");Cookies.set("font-size",(j-1)+"px")});var a=false;function h(k){$(".status").each(function(){$(this).text("trying")});var j=$("<div></div>").load(e+"/polr/updt?id="+k+"&page=0",function(m,l,n){if(l=="error"){$(".status").each(function(){$(this).text(n.statusText)})}else{$("#main-post").replaceWith(j.find("#main-post-container").html());$("#replies").replaceWith(j.find("#replies-container").html());$("title").text(j.find("#main-post-title").text()+" ~ xarql");if(a){}else{history.pushState("xarql","xarql",e+"/polr/"+k)}$(".status").each(function(){$(this).text(n.statusText)});$("html, body").animate({scrollTop:0},"fast");$("#replying-to-input").val(parseInt($("#main-post-id").text()));$("#page-dropdown").val(0);$("#prev-form").hide();$("#next-form").show();$("#next-form").css("display","inline");c()}})}function c(){$(".view-link").each(function(){$(this).unbind("click");$(this).on("click",function(){var j=$(this).attr("post-id");h(j);return false})})}c();window.addEventListener("popstate",function(k){var j=window.location.href.split("/");var l=j[j.length-1];a=true;h(l);a=false},false);function b(j){if(j==="light"){$("#theme-styles").attr("href",e+"/src/common/light-common.min.css");Cookies.set("theme","light");$("#light-theme-button").hide();$("#dark-theme-button").show()}else{$("#theme-styles").attr("href",e+"/src/common/dark-common.min.css");Cookies.set("theme","dark");$("#light-theme-button").show();$("#dark-theme-button").hide()}}b(Cookies.get("theme"));$("#dark-theme-button").on("click",function(){b("dark")});$("#light-theme-button").on("click",function(){b("light")});function g(j){if(j==="light"){$("p").css("font-weight","lighter");$(".bold").css("font-weight","normal");$("#font-light-button").hide();$("#font-normal-button").show();Cookies.set("font-weight","light")}else{$("p").css("font-weight","normal");$(".bold").css("font-weight","bold");$("#font-normal-button").hide();$("#font-light-button").show();Cookies.set("font-weight","normal")}}g(Cookies.get("font-weight"));$("#font-light-button").on("click",function(){g("light")});$("#font-normal-button").on("click",function(){g("normal")});$(".ajax-bar").each(function(){$(this).show()});$("#option-pane-open-button").on("click",function(){$("#option-pane").show();$("#option-pane-close-button").show();$(this).hide()});$("#option-pane-close-button").on("click",function(){$("#option-pane").hide();$("#option-pane-open-button").show();$(this).hide()})});