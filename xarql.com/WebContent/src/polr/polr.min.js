$(document).ready(function(){var f=document.getElementById("domain").getAttribute("value");function d(j){var m=decodeURIComponent(window.location.search.substring(1)),l=m.split("&"),n,k;for(k=0;k<l.length;k++){n=l[k].split("=");if(n[0]===j){return n[1]===undefined?true:n[1]}}}function h(){$(".status").each(function(){$(this).text("trying")});var i=$("<div></div>").load(f+"/polr/updt?id="+$("#main-post-id").text()+"&page="+$("#page").text()+"&sort="+$("#sort").text()+"&flow="+$("#flow").text()+"#full",function(k,j,l){if(j=="error"){$(".status").each(function(){$(this).text(l.statusText)})}else{$("#main-post").replaceWith(i.find("#main-post-container").html());$("#replies").replaceWith(i.find("#replies-container").html());$("title").text(i.find("#main-post-title").text()+" ~ xarql");c();$(".status").each(function(){$(this).text(l.statusText)})}})}var e=d("refresh");if(typeof e!="undefined"&&e==="true"){h();history.pushState("xarql","xarql",window.location.pathname)}$(".update-button").each(function(){var i=$(this);i.on("click",function(){h()})});$("#post-form").submit(function(l){l.preventDefault();$(".status").each(function(){$(this).text("trying")});var i=$(this),n=i.find("input[name='title']").val(),k=i.find("textarea[name='content']").val(),m=i.find("input[name='answers']").val(),j=i.attr("action");i.trigger("reset");$("#replying-to-input").val(parseInt($("#main-post-id").text()));$.ajax({type:"POST",url:j,data:{title:n,content:k,answers:m,}}).done(function(){$(".status").each(function(){$(this).text("success")})}).fail(function(){$(".status").each(function(){i.find("input[name='title']").val(n);i.find("textarea[name='content']").val(k);i.find("input[name='answers']").val(m);$(this).text("error")})}).always(function(){window.setTimeout(h,500)})});function g(){$(".status").each(function(){$(this).text("trying")});var j=$("#nav-form"),l=$("#page-dropdown").val(),k=$("#sort-dropdown").val(),i=$("#flow-dropdown").val();var m=$("<div></div>").load(f+"/polr/updt?id="+$("#main-post-id").text()+"&page="+l+"&sort="+k+"&flow="+i,function(o,n,p){if(n=="error"){$(".status").each(function(){$(this).text(p.statusText)})}else{$("#main-post").replaceWith(m.find("#main-post-container").html());$("#replies").replaceWith(m.find("#replies-container").html());$("title").text(m.find("#main-post-title").text()+" ~ xarql");history.pushState("xarql","xarql",window.location.pathname+"?page="+l+"&sort="+k+"&flow="+i);$("#page").text(l);$("#sort").text(k);$("#flow").text(i);c();if(l>0){$("#prev-form").show();$("#prev-form").css("display","inline")}else{$("#prev-form").hide()}if(l<9){$("#next-form").show();$("#next-form").css("display","inline")}else{$("#next-form").hide()}$(".status").each(function(){$(this).text(p.statusText)});$("html, body").animate({scrollTop:0},"fast")}})}$("#nav-form").submit(function(i){i.preventDefault();g()});$("#next-form").submit(function(i){i.preventDefault();var j=parseInt($("#page-dropdown").val());if(j<9){$("#page-dropdown").val(j+1)}g()});$("#prev-form").submit(function(i){i.preventDefault();var j=parseInt($("#page-dropdown").val());if(j>0){$("#page-dropdown").val(j-1)}g()});$("html").css("font-size",Cookies.get("font-size"));$("#text-up").on("click",function(){var i=parseFloat(window.getComputedStyle(document.getElementById("html")).fontSize);$("html").css("font-size",(i+1)+"px");Cookies.set("font-size",(i+1)+"px")});$("#text-dn").on("click",function(){var i=parseFloat(window.getComputedStyle(document.getElementById("html")).fontSize);$("html").css("font-size",(i-1)+"px");Cookies.set("font-size",(i-1)+"px")});var g=false;function a(j){$(".status").each(function(){$(this).text("trying")});var i=$("<div></div>").load(f+"/polr/updt?id="+j+"&page=0",function(l,k,m){if(k=="error"){$(".status").each(function(){$(this).text(m.statusText)})}else{$("#main-post").replaceWith(i.find("#main-post-container").html());$("#replies").replaceWith(i.find("#replies-container").html());$("title").text(i.find("#main-post-title").text()+" ~ xarql");if(g){}else{history.pushState("xarql","xarql",f+"/polr/"+j)}$(".status").each(function(){$(this).text(m.statusText)});$("html, body").animate({scrollTop:0},"fast");$("#replying-to-input").val(parseInt($("#main-post-id").text()));$("#page-dropdown").val(0);$("#prev-form").hide();$("#next-form").show();$("#next-form").css("display","inline");c()}})}function c(){$(".view-link").each(function(){$(this).unbind("click");$(this).on("click",function(){var i=$(this).attr("post-id");a(i);return false})})}c();window.addEventListener("popstate",function(j){var i=window.location.href.split("/");var k=i[i.length-1];g=true;a(k);g=false},false);function b(i){if(i==="light"){$("p").css("font-weight","lighter");$(".bold").css("font-weight","normal");$("#font-light-button").hide();$("#font-normal-button").show();Cookies.set("font-weight","light")}else{$("p").css("font-weight","normal");$(".bold").css("font-weight","bold");$("#font-normal-button").hide();$("#font-light-button").show();Cookies.set("font-weight","normal")}}b(Cookies.get("font-weight"));$("#font-light-button").on("click",function(){b("light")});$("#font-normal-button").on("click",function(){b("normal")});$(".ajax-bar").each(function(){$(this).show()});$("#option-pane-open-button").on("click",function(){$("#option-pane").show();$("#option-pane-close-button").show();$(this).hide()});$("#option-pane-close-button").on("click",function(){$("#option-pane").hide();$("#option-pane-open-button").show();$(this).hide()})});